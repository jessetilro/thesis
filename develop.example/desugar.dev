module test
model

  entity HasGrade {
    grade : Float?
  }

  entity Assignment extends HasGrade {
    grade : Float?
  }
  
  entity LeafAssignment extends Assignment {
    grade : Float?
  }
  
  entity CollectionAssignment extends Assignment {
    grade : Float? = avg(children.grade)
  }
  
  relation CollectionAssignment.children * <-> ? Assignment.parent
  
  entity Foo {
    grade : Float? = avg((collections ++ leaves).grade)
  }
  relation Foo.collections <-> CollectionAssignment.foos
  relation Foo.leaves      <-> LeafAssignment.foos